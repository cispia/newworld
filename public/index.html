<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<meta http-equiv="X-UA-Compatible" content="ie=edge">
	<title>首页</title>
	<script src="javascripts/jquery.min.js"></script>
	<!-- 最新版本的 Bootstrap 核心 CSS 文件 -->
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@3.3.7/dist/css/bootstrap.min.css"
		integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
	<!-- 最新的 Bootstrap 核心 JavaScript 文件 -->
	<script src="https://cdn.jsdelivr.net/npm/bootstrap@3.3.7/dist/js/bootstrap.min.js"
		integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa"
		crossorigin="anonymous"></script>
	<style>
		* {
			margin: 0;
			padding: 0;
			user-select: none;
		}

		#img {
			width: 80px;
			height: 80px;
			background: #ccc;
			border-radius: 50%;
		}

		.img {
			width: 100%;
			height: 100%;
			border-radius: 50%;
		}

		#search {
			margin: 10px 0 0 25%;
		}

		#text {
			width: 50%;
			margin-right: -5px;
			border-radius: 15px 0px 0px 15px;
			padding-left: 10px;
			outline-style: none;
			height: 30px;
			border-style: none;
			border: 1px solid;
		}

		#btn_search {
			width: 80px;
			height: 30px;
			outline-style: none;
			border-radius: 0px 15px 15px 0px;
			border-style: none;
		}

		#tuijian {
			width: 50%;
			margin: 10px auto;
			line-height: 30px;
			height: 30px;
			/* overflow: hidden; */
		}

		#tuijian .rs {
			width: 80%;
			height: 30px;
			overflow: hidden;
		}

		#tuijian .rs a {
			display: inline-block;
			padding: 0px 15px;
			margin-right: 10px;
			text-decoration: none;
			color: #000;
			border: 1px solid #ccc;
			border-radius: 20px;
			line-height: 24px;
		}

		#list {
			width: 100%;
		}

		#ul li {
			width: 22%;
			height: 400px;
			float: left;
			list-style: none;
			background: rgba(206, 243, 255, 0.438);
			margin: 1.5%;
		}


		#ul li img {
			width: 80%;
			margin: 5% 10% 5% 10%;
			height: 300px;
			transition: .35s;
		}

		#ul li img:hover {
			transform: scale(1.1);
			box-shadow: 0 0 5px 5px rgba(0, 0, 0, .2);
			transition: .35s;
		}

		#ul li p {
			margin: 0 0 10px 10%;
			color: #000;
			line-height: 30px;
			font-size: 20px;
		}

		#ul li span {
			margin: 0 0 0 14%;
			font-size: 18px;
			color: #000;
			line-height: 30px;
		}

		#booklist {
			min-height: 600px;
			border: 1px solid #ccc;
			display: none;
		}

		#uls li {
			height: 220px;
			list-style: none;
			border-bottom: 1px solid #ccc;
		}

		#uls li img {
			width: 130px;
			height: 200px;
			border: 1px solid #ccc;
			margin: 10px 20px 10px 20px;
			float: left;
		}

		#cover-book-title {
			width: 80%;
			margin-left: 20%;
			display: block;
			padding-top: 10px;
			font-size: 20px;
		}

		#author {
			width: 80%;
			margin: 20px 0 0 20%;
			display: block;
			color: #ccc;
			font-size: 18px;
		}

		#jianjie {
			overflow: hidden;
			margin: 20px 0 0 20%;
			width: 80%;
		}

		#img {
			width: 80px;
			height: 80px;
			background: #ccc;
			border-radius: 50%;
		}

		.back {
			font-size: 45px;
			height: 50px;
			background: none;
			float: left;
			border: saddlebrown;
			padding: 0 10px;
			margin-top: -5px;
			border-radius: 10px;
			outline: none
		}
	</style>
</head>



<!-- 头部 -->
<div class="head" style="background:#dcdcdc4d;width: 100%;height: 70px;">
	<div class="container">
		<div class="logo" style="width: 100px;height: 70px;display: inline-block;">
			<img src="http://www.cnlogo8.com/d/file/2017-04-13/5a97b5fd70fa3a059e2ac9cc4a891989.png" alt="返回首页"
				style="width: 100%;height: 100%;">
		</div>
		<!--登录注册-->
		<div id="log"
			style="float: right;width: 100px;height: 70px;line-height: 70px;text-align: center;font-size: 20px;">
			<span data-toggle="modal" data-target="#login" class="login">登录</span> /
			<span data-toggle="modal" data-target="#logup" class="logup">注册</span>
		</div>
		<!--头像-->
		<div id="myimg" style="float: right;width: 70px;height: 70px;display: none;position: relative;">
			<img src="" alt="" id="imgs" style="padding:6px;width: 70px;height: 70px;border-radius: 50%;" />
			<div id="div"
				style="width: 130px;height: 110px;background: #aaa;text-align: center;line-height: 30px;display: none;margin-left: -20px;position: absolute;left: 0;bottom:-110px;z-index: 10;">
				<p style="border-bottom: 1px dotted #fff;">
					<a href="booklist.html" style="text-decoration: none;color: #fff;">书架</a>
				</p>
				<p style="border-bottom: 1px dotted #fff;">
					<a href="mymsg.html" style="text-decoration: none;color: #fff;">个人中心</a>
				</p>
				<p style="border-bottom: 1px dotted #fff; color: #fff;" id="btn_out">退出登录</p>
			</div>
		</div>

		<!--头像结束-->
	</div>
</div>
<!-- 头部结束 -->

<!-- 内容 -->
<div class="container" id="con" style="min-height:1000px;border:1px solid red;">
	<!--搜索-->
	<div id="search">
		<input type="text" id="text" placeholder="搜索小说">
		<button id="btn_search">搜索</button>
	</div>

	<!--搜索结束-->
	<!--推荐搜索-->
	<div id="tuijian"> <span style="display: block;float: left;">推荐搜索：</span>
		<div style="display:block;float: left;" class="rs"></div>
	</div>
	<!--推荐搜索结束-->

	<!--热搜小说-->
	<div id="list">
		<ul id="ul">

		</ul>
	</div>
	<!--结束-->

</div>
<!-- 内容结束 -->
<!--搜索列表-->
<div class="container" id="booklist">
	<!--返回-->
	<div
		style="height:50px;text-align: center;margin-top: 10px;border-bottom: 1px solid #ccc;font-size: 20px;line-height: 50px;">
		<button class="back glyphicon glyphicon-arrow-left"></button>
		搜索列表
	</div>
	<!--返回结束-->

	<!--列表-->
	<ul id="uls">

	</ul>
	<!--列表结束-->
</div>
<!--搜索列表结束-->

<!-- 尾部 -->
<div class="foot" style="width: 100%;height:100px;background:#333;color: #fff;text-align: center;padding-top: 10px;">
	<div class="container">
		<p>海量图书，更高品质阅读体验</p>
		<p>网络文化经营许可证：粤网文[2017]3018-499号</p>
		<p>Designed and built with all the love in the world by @mdo and @fat. Maintained by the core team with the help
			of our contributors.</p>
	</div>
</div>
<!-- 尾部结束 -->

<!--注册-->
<div class="modal fade" tabindex="-1" role="dialog" aria-labelledby="mySmallModalLabel" id="logup">
	<div class="modal-dialog modal-sm" role="document">
		<div class="modal-content">
			<div class="modal-header">
				<button type="button" class="close" data-dismiss="modal" aria-label="Close"><span
						aria-hidden="true">&times;</span></button>
				<h4 class="modal-title" id="myModalLabel">注册</h4>
			</div>
			<div class="modal-body">
				<div class="form-group">
					<label for="img">头像
						<input style="display:none;" type="file" class="files" id="img">
						<div id="img"><img class="img" src="" alt=""></div>
					</label>
				</div>
				<div class="form-group">
					<label for="name">昵称</label>
					<input type="text" class="form-control" id="name_up" placeholder="昵称">
				</div>
				<div class="form-group">
					<label for="user">账号</label>
					<input type="text" class="form-control" id="user_up" placeholder="账号">
				</div>
				<div class="form-group">
					<label for="pass">密码</label>
					<input type="password" class="form-control" id="pass_up" placeholder="密码">
				</div>
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-default" data-dismiss="modal" id="btn_up">确定</button>
			</div>
		</div>
	</div>
</div>
<!--结束-->
<!--登录-->
<div class="modal fade" tabindex="-1" role="dialog" aria-labelledby="mySmallModalLabel" id="login">
	<div class="modal-dialog modal-sm" role="document">
		<div class="modal-content">
			<div class="modal-header">
				<button type="button" class="close" data-dismiss="modal" aria-label="Close"><span
						aria-hidden="true">&times;</span></button>
				<h4 class="modal-title" id="myModalLabel">登录</h4>
			</div>
			<div class="modal-body">

				<div class="form-group">
					<label for="user">账号</label>
					<input type="text" class="form-control" id="user_in" placeholder="账号">
				</div>
				<div class="form-group">
					<label for="pass">密码</label>
					<input type="password" class="form-control" id="pass_in" placeholder="密码">
				</div>
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-default" data-dismiss="modal" id="btn_in">确定</button>
			</div>
		</div>
	</div>
</div>
<!--结束-->
</body>

<!---->
<script src="javascripts/jquery.min.js"></script>
<script>
	window.onresize = function () {
		$(".foot").css("bottom", "0");
	}
	var href = 'http://localhost:8000';
	//搜索
	$('#btn_search').on('click', function () {
		if ($('#text').val() == '') {
			alert('输入内容不能为空');
			return;
		} else {
			$.ajax({
				type: 'post',
				url: href + '/seatch',
				data: {
					hotkey: $('#text').val()
				},
				success(data) {
					console.log(data);
					$('#text').val('');
					$('#uls').empty();
					con.style.display = 'none';
					booklist.style.display = 'block';
					$.each(data, function (i, o) {
						var li = $(`<li>
									<a href="details.html">
										<img src="${o.bookimg}" />
									</a>
									<p id="cover-book-title">《${o.name}》</p>
									<p id="author">${o.author}</p>
									<p id="jianjie">${o.briefing}</p>
								</li>`)
						$('#uls').append(li);
						$(li).on("click", function () {
							localStorage.bookmsg = JSON.stringify(data[$(this).index()]);
						})
					})
				}
			})
		}

	})
	$.ajax({
		url: href + '/resou',
		type: 'post',
		success(data) {
			if (data.length == 0) {
				$('#ul').text("暂时没有数据");
				return;
			} else {
				data = data.splice(0, 8);
				$.each(data, function (i, o) {
					var li = $(`
					<li>
					<a href="details.html" style="text-decoration: none;">
						<img src="${o.bookimg}" alt="" />
						<p>《${o.name}》</p>
						<span>${o.author}</span>
					</a>
				</li>`)
					var span = $(`<a>${o.name}</a>`)
					$(span).on('click', function () {
						$.ajax({
							type: 'post',
							url: href + '/seatch',
							data: {
								hotkey: $(this).text()
							},
							success(num) {
								console.log(num);
								$('#text').val('');
								$('#uls').empty();
								con.style.display = 'none';
								booklist.style.display = 'block';
								$.each(num, function (i, o) {
									var li = $(`<li>
									<a href="details.html">
										<img src="${o.bookimg}" />
									</a>
									<p id="cover-book-title">《${o.name}》</p>
									<p id="author">${o.author}</p>
									<p id="jianjie">${o.briefing}</p>
								</li>`)
									$('#uls').append(li);
									$(li).on('click', function () {
										localStorage.bookmsg = JSON.stringify(num[$(this).index()]);
									})
								})
							}
						})
					})
					$('.rs').append(span);
					$('#ul').append(li);
					$(li).on('click', function () {
						localStorage.bookmsg = JSON.stringify(data[$(this).index()]);
					})
				})
			}
		}
	})
	//获取登录状态
	if (localStorage.user) {
		var json = JSON.parse(localStorage.user);
		$("#imgs").attr("src", json.img);
		log.style.display = 'none';
		myimg.style.display = 'block';
	}
	//头像
	var imgurl = '';
	$(".files").on("change", function () {
		var files = $(this)[0].files[0];
		var d = new FormData;
		d.append("tx", files);
		$.ajax({
			url: href + "/cover/cover",
			type: "post",
			data: d,
			contentType: false,
			processData: false,
			success(data) {
				imgurl = href + data;
				console.log(imgurl);
				$(".img").attr("src", imgurl);
			}
		})
	})
	// 中文检测
	function isChineseChar(str) {
		var reg = /[\u4E00-\u9FA5\uF900-\uFA2D]/;
		return reg.test(str);
	}
	// 登录
	$("#btn_in").on("click", () => {
		if ($("#user_in").val() == "" || $("#pass_in").val() == "") {
			alert("密码或账号不能为空");
			return;
		} else if (isChineseChar($("#user_in").val()) || isChineseChar($("#pass_in").val())) {
			alert("密码和账号不能为中文");
			return;
		} else {
			$.ajax({
				url: href + "/in",
				type: "post",
				data: {
					user: $("#user_in").val(),
					pass: $("#pass_in").val(),
				},
				success(data) {
					if (data.length == 0) {
						alert('账号或密码错误');
						return;
					}
					log.style.display = 'none';
					myimg.style.display = 'block';
					localStorage.user = JSON.stringify(data);
					alert(data.tip);
					$("#imgs").attr("src", data.img);
				}
			})
		}
	})
	// 注册
	$("#btn_up").on("click", () => {
		if ($("#user_up").val() == "" || $("#pass_up").val() == "" || $("#name_up").val() == "" || imgurl == "") {
			alert("密码或账号不能为空");
			return;
		} else if (isChineseChar($("#user_up").val()) || isChineseChar($("#pass_up").val())) {
			alert("密码和账号不能为中文");
			return;
		} else {
			$.ajax({
				url: href + "/up",
				type: "post",
				data: {
					name: $("#name_up").val(),
					user: $("#user_up").val(),
					pass: $("#pass_up").val(),
					userimg: imgurl
				},
				success(data) {
					alert(data);
				}
			})
		}
	})

	imgs.onclick = function () {
		$("#div").fadeIn(1000);
	}
	imgs.ondblclick = function () {
		$("#div").fadeOut(1000);
	}
	//退出登录
	btn_out.onclick = function () {
		localStorage.user = "";
		myimg.style.display = 'none';
		log.style.display = 'block';
	}
	//返回
	$('.back').on('click', function () {
		history.back();
		con.style.display = 'block';
		booklist.style.display = 'none';
	})
	//返回首页
	$('.logo').on('click', function () {
		location.href = 'index.html';
	})
</script>

</html>